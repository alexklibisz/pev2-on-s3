{
  "title": "Top 10 products by revenue",
  "query": "-- Top 10 products by revenue\nSELECT\n  p.id,\n  p.name,\n  SUM(oi.quantity * oi.unit_price) AS total_revenue,\n  SUM(oi.quantity) AS total_quantity,\n  COUNT(DISTINCT oi.order_id) AS order_count\nFROM products p\nJOIN order_items oi ON oi.product_id = p.id\nGROUP BY p.id, p.name\nORDER BY total_revenue DESC\nLIMIT 10;",
  "plan": "[\n  {\n    \"Plan\": {\n      \"Node Type\": \"Limit\",\n      \"Parallel Aware\": false,\n      \"Async Capable\": false,\n      \"Startup Cost\": 18965.95,\n      \"Total Cost\": 18965.98,\n      \"Plan Rows\": 10,\n      \"Plan Width\": 63,\n      \"Actual Startup Time\": 114.246,\n      \"Actual Total Time\": 114.248,\n      \"Actual Rows\": 10,\n      \"Actual Loops\": 1,\n      \"Shared Hit Blocks\": 149072,\n      \"Shared Read Blocks\": 1103,\n      \"Shared Dirtied Blocks\": 0,\n      \"Shared Written Blocks\": 0,\n      \"Local Hit Blocks\": 0,\n      \"Local Read Blocks\": 0,\n      \"Local Dirtied Blocks\": 0,\n      \"Local Written Blocks\": 0,\n      \"Temp Read Blocks\": 0,\n      \"Temp Written Blocks\": 0,\n      \"Plans\": [\n        {\n          \"Node Type\": \"Sort\",\n          \"Parent Relationship\": \"Outer\",\n          \"Parallel Aware\": false,\n          \"Async Capable\": false,\n          \"Startup Cost\": 18965.95,\n          \"Total Cost\": 18967.20,\n          \"Plan Rows\": 500,\n          \"Plan Width\": 63,\n          \"Actual Startup Time\": 114.244,\n          \"Actual Total Time\": 114.245,\n          \"Actual Rows\": 10,\n          \"Actual Loops\": 1,\n          \"Sort Key\": [\"(sum(((oi.quantity)::numeric * oi.unit_price))) DESC\"],\n          \"Sort Method\": \"top-N heapsort\",\n          \"Sort Space Used\": 26,\n          \"Sort Space Type\": \"Memory\",\n          \"Shared Hit Blocks\": 149072,\n          \"Shared Read Blocks\": 1103,\n          \"Shared Dirtied Blocks\": 0,\n          \"Shared Written Blocks\": 0,\n          \"Local Hit Blocks\": 0,\n          \"Local Read Blocks\": 0,\n          \"Local Dirtied Blocks\": 0,\n          \"Local Written Blocks\": 0,\n          \"Temp Read Blocks\": 0,\n          \"Temp Written Blocks\": 0,\n          \"Plans\": [\n            {\n              \"Node Type\": \"Aggregate\",\n              \"Strategy\": \"Sorted\",\n              \"Partial Mode\": \"Simple\",\n              \"Parent Relationship\": \"Outer\",\n              \"Parallel Aware\": false,\n              \"Async Capable\": false,\n              \"Startup Cost\": 30.19,\n              \"Total Cost\": 18955.15,\n              \"Plan Rows\": 500,\n              \"Plan Width\": 63,\n              \"Actual Startup Time\": 3.393,\n              \"Actual Total Time\": 114.085,\n              \"Actual Rows\": 500,\n              \"Actual Loops\": 1,\n              \"Group Key\": [\"p.id\"],\n              \"Shared Hit Blocks\": 149069,\n              \"Shared Read Blocks\": 1103,\n              \"Shared Dirtied Blocks\": 0,\n              \"Shared Written Blocks\": 0,\n              \"Local Hit Blocks\": 0,\n              \"Local Read Blocks\": 0,\n              \"Local Dirtied Blocks\": 0,\n              \"Local Written Blocks\": 0,\n              \"Temp Read Blocks\": 0,\n              \"Temp Written Blocks\": 0,\n              \"Plans\": [\n                {\n                  \"Node Type\": \"Incremental Sort\",\n                  \"Parent Relationship\": \"Outer\",\n                  \"Parallel Aware\": false,\n                  \"Async Capable\": false,\n                  \"Startup Cost\": 30.19,\n                  \"Total Cost\": 16698.90,\n                  \"Plan Rows\": 150000,\n                  \"Plan Width\": 29,\n                  \"Actual Startup Time\": 2.812,\n                  \"Actual Total Time\": 84.287,\n                  \"Actual Rows\": 150000,\n                  \"Actual Loops\": 1,\n                  \"Sort Key\": [\"p.id\", \"oi.order_id\"],\n                  \"Presorted Key\": [\"p.id\"],\n                  \"Full-sort Groups\": {\n                    \"Group Count\": 500,\n                    \"Sort Methods Used\": [\"quicksort\"],\n                    \"Sort Space Memory\": {\n                      \"Average Sort Space Used\": 28,\n                      \"Peak Sort Space Used\": 28\n                    }\n                  },\n                  \"Pre-sorted Groups\": {\n                    \"Group Count\": 500,\n                    \"Sort Methods Used\": [\"quicksort\"],\n                    \"Sort Space Memory\": {\n                      \"Average Sort Space Used\": 39,\n                      \"Peak Sort Space Used\": 39\n                    }\n                  },\n                  \"Shared Hit Blocks\": 149069,\n                  \"Shared Read Blocks\": 1103,\n                  \"Shared Dirtied Blocks\": 0,\n                  \"Shared Written Blocks\": 0,\n                  \"Local Hit Blocks\": 0,\n                  \"Local Read Blocks\": 0,\n                  \"Local Dirtied Blocks\": 0,\n                  \"Local Written Blocks\": 0,\n                  \"Temp Read Blocks\": 0,\n                  \"Temp Written Blocks\": 0,\n                  \"Plans\": [\n                    {\n                      \"Node Type\": \"Merge Join\",\n                      \"Parent Relationship\": \"Outer\",\n                      \"Parallel Aware\": false,\n                      \"Async Capable\": false,\n                      \"Join Type\": \"Inner\",\n                      \"Startup Cost\": 0.57,\n                      \"Total Cost\": 8642.28,\n                      \"Plan Rows\": 150000,\n                      \"Plan Width\": 29,\n                      \"Actual Startup Time\": 0.031,\n                      \"Actual Total Time\": 55.347,\n                      \"Actual Rows\": 150000,\n                      \"Actual Loops\": 1,\n                      \"Inner Unique\": false,\n                      \"Merge Cond\": \"(p.id = oi.product_id)\",\n                      \"Shared Hit Blocks\": 149069,\n                      \"Shared Read Blocks\": 1103,\n                      \"Shared Dirtied Blocks\": 0,\n                      \"Shared Written Blocks\": 0,\n                      \"Local Hit Blocks\": 0,\n                      \"Local Read Blocks\": 0,\n                      \"Local Dirtied Blocks\": 0,\n                      \"Local Written Blocks\": 0,\n                      \"Temp Read Blocks\": 0,\n                      \"Temp Written Blocks\": 0,\n                      \"Plans\": [\n                        {\n                          \"Node Type\": \"Index Scan\",\n                          \"Parent Relationship\": \"Outer\",\n                          \"Parallel Aware\": false,\n                          \"Async Capable\": false,\n                          \"Scan Direction\": \"Forward\",\n                          \"Index Name\": \"products_pkey\",\n                          \"Relation Name\": \"products\",\n                          \"Alias\": \"p\",\n                          \"Startup Cost\": 0.27,\n                          \"Total Cost\": 31.77,\n                          \"Plan Rows\": 500,\n                          \"Plan Width\": 15,\n                          \"Actual Startup Time\": 0.015,\n                          \"Actual Total Time\": 0.119,\n                          \"Actual Rows\": 500,\n                          \"Actual Loops\": 1,\n                          \"Shared Hit Blocks\": 5,\n                          \"Shared Read Blocks\": 3,\n                          \"Shared Dirtied Blocks\": 0,\n                          \"Shared Written Blocks\": 0,\n                          \"Local Hit Blocks\": 0,\n                          \"Local Read Blocks\": 0,\n                          \"Local Dirtied Blocks\": 0,\n                          \"Local Written Blocks\": 0,\n                          \"Temp Read Blocks\": 0,\n                          \"Temp Written Blocks\": 0\n                        },\n                        {\n                          \"Node Type\": \"Index Scan\",\n                          \"Parent Relationship\": \"Inner\",\n                          \"Parallel Aware\": false,\n                          \"Async Capable\": false,\n                          \"Scan Direction\": \"Forward\",\n                          \"Index Name\": \"idx_order_items_product_id\",\n                          \"Relation Name\": \"order_items\",\n                          \"Alias\": \"oi\",\n                          \"Startup Cost\": 0.29,\n                          \"Total Cost\": 6734.26,\n                          \"Plan Rows\": 150000,\n                          \"Plan Width\": 18,\n                          \"Actual Startup Time\": 0.011,\n                          \"Actual Total Time\": 39.931,\n                          \"Actual Rows\": 150000,\n                          \"Actual Loops\": 1,\n                          \"Shared Hit Blocks\": 149064,\n                          \"Shared Read Blocks\": 1100,\n                          \"Shared Dirtied Blocks\": 0,\n                          \"Shared Written Blocks\": 0,\n                          \"Local Hit Blocks\": 0,\n                          \"Local Read Blocks\": 0,\n                          \"Local Dirtied Blocks\": 0,\n                          \"Local Written Blocks\": 0,\n                          \"Temp Read Blocks\": 0,\n                          \"Temp Written Blocks\": 0\n                        }\n                      ]\n                    }\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    \"Planning\": {\n      \"Shared Hit Blocks\": 202,\n      \"Shared Read Blocks\": 5,\n      \"Shared Dirtied Blocks\": 0,\n      \"Shared Written Blocks\": 0,\n      \"Local Hit Blocks\": 0,\n      \"Local Read Blocks\": 0,\n      \"Local Dirtied Blocks\": 0,\n      \"Local Written Blocks\": 0,\n      \"Temp Read Blocks\": 0,\n      \"Temp Written Blocks\": 0\n    },\n    \"Planning Time\": 2.069,\n    \"Triggers\": [\n    ],\n    \"Execution Time\": 114.370\n  }\n]"
}
