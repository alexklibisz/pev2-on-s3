{
  "title": "Products with above-average review ratings",
  "query": "-- Products with above-average review ratings\nSELECT\n  p.id,\n  p.name,\n  p.price,\n  AVG(r.rating) AS avg_rating,\n  COUNT(r.id) AS review_count\nFROM products p\nJOIN reviews r ON r.product_id = p.id\nGROUP BY p.id, p.name, p.price\nHAVING AVG(r.rating) > (\n  SELECT AVG(rating) FROM reviews\n)\nORDER BY avg_rating DESC, review_count DESC\nLIMIT 20;",
  "plan": "[\n  {\n    \"Plan\": {\n      \"Node Type\": \"Limit\",\n      \"Parallel Aware\": false,\n      \"Async Capable\": false,\n      \"Startup Cost\": 1175.15,\n      \"Total Cost\": 1175.20,\n      \"Plan Rows\": 20,\n      \"Plan Width\": 61,\n      \"Actual Startup Time\": 8.828,\n      \"Actual Total Time\": 8.832,\n      \"Actual Rows\": 20,\n      \"Actual Loops\": 1,\n      \"Shared Hit Blocks\": 260,\n      \"Shared Read Blocks\": 245,\n      \"Shared Dirtied Blocks\": 0,\n      \"Shared Written Blocks\": 0,\n      \"Local Hit Blocks\": 0,\n      \"Local Read Blocks\": 0,\n      \"Local Dirtied Blocks\": 0,\n      \"Local Written Blocks\": 0,\n      \"Temp Read Blocks\": 0,\n      \"Temp Written Blocks\": 0,\n      \"Plans\": [\n        {\n          \"Node Type\": \"Aggregate\",\n          \"Strategy\": \"Plain\",\n          \"Partial Mode\": \"Simple\",\n          \"Parent Relationship\": \"InitPlan\",\n          \"Subplan Name\": \"InitPlan 1\",\n          \"Parallel Aware\": false,\n          \"Async Capable\": false,\n          \"Startup Cost\": 497.00,\n          \"Total Cost\": 497.01,\n          \"Plan Rows\": 1,\n          \"Plan Width\": 32,\n          \"Actual Startup Time\": 2.093,\n          \"Actual Total Time\": 2.093,\n          \"Actual Rows\": 1,\n          \"Actual Loops\": 1,\n          \"Shared Hit Blocks\": 247,\n          \"Shared Read Blocks\": 0,\n          \"Shared Dirtied Blocks\": 0,\n          \"Shared Written Blocks\": 0,\n          \"Local Hit Blocks\": 0,\n          \"Local Read Blocks\": 0,\n          \"Local Dirtied Blocks\": 0,\n          \"Local Written Blocks\": 0,\n          \"Temp Read Blocks\": 0,\n          \"Temp Written Blocks\": 0,\n          \"Plans\": [\n            {\n              \"Node Type\": \"Seq Scan\",\n              \"Parent Relationship\": \"Outer\",\n              \"Parallel Aware\": false,\n              \"Async Capable\": false,\n              \"Relation Name\": \"reviews\",\n              \"Alias\": \"reviews\",\n              \"Startup Cost\": 0.00,\n              \"Total Cost\": 447.00,\n              \"Plan Rows\": 20000,\n              \"Plan Width\": 4,\n              \"Actual Startup Time\": 0.005,\n              \"Actual Total Time\": 0.930,\n              \"Actual Rows\": 20000,\n              \"Actual Loops\": 1,\n              \"Shared Hit Blocks\": 247,\n              \"Shared Read Blocks\": 0,\n              \"Shared Dirtied Blocks\": 0,\n              \"Shared Written Blocks\": 0,\n              \"Local Hit Blocks\": 0,\n              \"Local Read Blocks\": 0,\n              \"Local Dirtied Blocks\": 0,\n              \"Local Written Blocks\": 0,\n              \"Temp Read Blocks\": 0,\n              \"Temp Written Blocks\": 0\n            }\n          ]\n        },\n        {\n          \"Node Type\": \"Sort\",\n          \"Parent Relationship\": \"Outer\",\n          \"Parallel Aware\": false,\n          \"Async Capable\": false,\n          \"Startup Cost\": 678.14,\n          \"Total Cost\": 678.56,\n          \"Plan Rows\": 167,\n          \"Plan Width\": 61,\n          \"Actual Startup Time\": 8.827,\n          \"Actual Total Time\": 8.829,\n          \"Actual Rows\": 20,\n          \"Actual Loops\": 1,\n          \"Sort Key\": [\"(avg(r.rating)) DESC\", \"(count(r.id)) DESC\"],\n          \"Sort Method\": \"top-N heapsort\",\n          \"Sort Space Used\": 26,\n          \"Sort Space Type\": \"Memory\",\n          \"Shared Hit Blocks\": 260,\n          \"Shared Read Blocks\": 245,\n          \"Shared Dirtied Blocks\": 0,\n          \"Shared Written Blocks\": 0,\n          \"Local Hit Blocks\": 0,\n          \"Local Read Blocks\": 0,\n          \"Local Dirtied Blocks\": 0,\n          \"Local Written Blocks\": 0,\n          \"Temp Read Blocks\": 0,\n          \"Temp Written Blocks\": 0,\n          \"Plans\": [\n            {\n              \"Node Type\": \"Aggregate\",\n              \"Strategy\": \"Hashed\",\n              \"Partial Mode\": \"Simple\",\n              \"Parent Relationship\": \"Outer\",\n              \"Parallel Aware\": false,\n              \"Async Capable\": false,\n              \"Startup Cost\": 666.19,\n              \"Total Cost\": 673.69,\n              \"Plan Rows\": 167,\n              \"Plan Width\": 61,\n              \"Actual Startup Time\": 8.673,\n              \"Actual Total Time\": 8.770,\n              \"Actual Rows\": 200,\n              \"Actual Loops\": 1,\n              \"Group Key\": [\"p.id\"],\n              \"Filter\": \"(avg(r.rating) > (InitPlan 1).col1)\",\n              \"Planned Partitions\": 0,\n              \"HashAgg Batches\": 1,\n              \"Peak Memory Usage\": 169,\n              \"Disk Usage\": 0,\n              \"Rows Removed by Filter\": 300,\n              \"Shared Hit Blocks\": 254,\n              \"Shared Read Blocks\": 245,\n              \"Shared Dirtied Blocks\": 0,\n              \"Shared Written Blocks\": 0,\n              \"Local Hit Blocks\": 0,\n              \"Local Read Blocks\": 0,\n              \"Local Dirtied Blocks\": 0,\n              \"Local Written Blocks\": 0,\n              \"Temp Read Blocks\": 0,\n              \"Temp Written Blocks\": 0,\n              \"Plans\": [\n                {\n                  \"Node Type\": \"Hash Join\",\n                  \"Parent Relationship\": \"Outer\",\n                  \"Parallel Aware\": false,\n                  \"Async Capable\": false,\n                  \"Join Type\": \"Inner\",\n                  \"Startup Cost\": 16.25,\n                  \"Total Cost\": 516.19,\n                  \"Plan Rows\": 20000,\n                  \"Plan Width\": 29,\n                  \"Actual Startup Time\": 0.107,\n                  \"Actual Total Time\": 4.543,\n                  \"Actual Rows\": 20000,\n                  \"Actual Loops\": 1,\n                  \"Inner Unique\": true,\n                  \"Hash Cond\": \"(r.product_id = p.id)\",\n                  \"Shared Hit Blocks\": 7,\n                  \"Shared Read Blocks\": 245,\n                  \"Shared Dirtied Blocks\": 0,\n                  \"Shared Written Blocks\": 0,\n                  \"Local Hit Blocks\": 0,\n                  \"Local Read Blocks\": 0,\n                  \"Local Dirtied Blocks\": 0,\n                  \"Local Written Blocks\": 0,\n                  \"Temp Read Blocks\": 0,\n                  \"Temp Written Blocks\": 0,\n                  \"Plans\": [\n                    {\n                      \"Node Type\": \"Seq Scan\",\n                      \"Parent Relationship\": \"Outer\",\n                      \"Parallel Aware\": false,\n                      \"Async Capable\": false,\n                      \"Relation Name\": \"reviews\",\n                      \"Alias\": \"r\",\n                      \"Startup Cost\": 0.00,\n                      \"Total Cost\": 447.00,\n                      \"Plan Rows\": 20000,\n                      \"Plan Width\": 12,\n                      \"Actual Startup Time\": 0.010,\n                      \"Actual Total Time\": 1.824,\n                      \"Actual Rows\": 20000,\n                      \"Actual Loops\": 1,\n                      \"Shared Hit Blocks\": 2,\n                      \"Shared Read Blocks\": 245,\n                      \"Shared Dirtied Blocks\": 0,\n                      \"Shared Written Blocks\": 0,\n                      \"Local Hit Blocks\": 0,\n                      \"Local Read Blocks\": 0,\n                      \"Local Dirtied Blocks\": 0,\n                      \"Local Written Blocks\": 0,\n                      \"Temp Read Blocks\": 0,\n                      \"Temp Written Blocks\": 0\n                    },\n                    {\n                      \"Node Type\": \"Hash\",\n                      \"Parent Relationship\": \"Inner\",\n                      \"Parallel Aware\": false,\n                      \"Async Capable\": false,\n                      \"Startup Cost\": 10.00,\n                      \"Total Cost\": 10.00,\n                      \"Plan Rows\": 500,\n                      \"Plan Width\": 21,\n                      \"Actual Startup Time\": 0.090,\n                      \"Actual Total Time\": 0.091,\n                      \"Actual Rows\": 500,\n                      \"Actual Loops\": 1,\n                      \"Hash Buckets\": 1024,\n                      \"Original Hash Buckets\": 1024,\n                      \"Hash Batches\": 1,\n                      \"Original Hash Batches\": 1,\n                      \"Peak Memory Usage\": 35,\n                      \"Shared Hit Blocks\": 5,\n                      \"Shared Read Blocks\": 0,\n                      \"Shared Dirtied Blocks\": 0,\n                      \"Shared Written Blocks\": 0,\n                      \"Local Hit Blocks\": 0,\n                      \"Local Read Blocks\": 0,\n                      \"Local Dirtied Blocks\": 0,\n                      \"Local Written Blocks\": 0,\n                      \"Temp Read Blocks\": 0,\n                      \"Temp Written Blocks\": 0,\n                      \"Plans\": [\n                        {\n                          \"Node Type\": \"Seq Scan\",\n                          \"Parent Relationship\": \"Outer\",\n                          \"Parallel Aware\": false,\n                          \"Async Capable\": false,\n                          \"Relation Name\": \"products\",\n                          \"Alias\": \"p\",\n                          \"Startup Cost\": 0.00,\n                          \"Total Cost\": 10.00,\n                          \"Plan Rows\": 500,\n                          \"Plan Width\": 21,\n                          \"Actual Startup Time\": 0.003,\n                          \"Actual Total Time\": 0.040,\n                          \"Actual Rows\": 500,\n                          \"Actual Loops\": 1,\n                          \"Shared Hit Blocks\": 5,\n                          \"Shared Read Blocks\": 0,\n                          \"Shared Dirtied Blocks\": 0,\n                          \"Shared Written Blocks\": 0,\n                          \"Local Hit Blocks\": 0,\n                          \"Local Read Blocks\": 0,\n                          \"Local Dirtied Blocks\": 0,\n                          \"Local Written Blocks\": 0,\n                          \"Temp Read Blocks\": 0,\n                          \"Temp Written Blocks\": 0\n                        }\n                      ]\n                    }\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    },\n    \"Planning\": {\n      \"Shared Hit Blocks\": 171,\n      \"Shared Read Blocks\": 8,\n      \"Shared Dirtied Blocks\": 1,\n      \"Shared Written Blocks\": 0,\n      \"Local Hit Blocks\": 0,\n      \"Local Read Blocks\": 0,\n      \"Local Dirtied Blocks\": 0,\n      \"Local Written Blocks\": 0,\n      \"Temp Read Blocks\": 0,\n      \"Temp Written Blocks\": 0\n    },\n    \"Planning Time\": 0.579,\n    \"Triggers\": [\n    ],\n    \"Execution Time\": 8.907\n  }\n]"
}
